config.tx_extbase.objects {
	Tx_Fileman_Service_CsrfProtectServiceInterface {
		className = Tx_Fileman_Service_Typo3CsrfProtectService
	}
}

includeLibs.Tx_Fileman_TypoScript = EXT:fileman/Resources/Private/Scripts/Tx_Fileman_Typoscript.php
lib.tx_fileman.maxFileUploads = USER
lib.tx_fileman.maxFileUploads.userFunc = Tx_Fileman_TypoScript->getMaxFileUploads

plugin.tx_fileman {
	view {
		templateRootPath = {$plugin.tx_fileman.view.templateRootPath}
		partialRootPath = {$plugin.tx_fileman.view.partialRootPath}
		layoutRootPath = {$plugin.tx_fileman.view.layoutRootPath}
	}
	persistence {
		storagePid = {$plugin.tx_fileman.persistence.storagePid}
		classes {
			Tx_Fileman_Domain_Model_Category {
				mapping.columns {
					fe_group.mapOnProperty = feGroup
				}
			}
			Tx_Fileman_Domain_Model_File {
				mapping.columns {
					tstamp.mapOnProperty = tstamp
					fe_group.mapOnProperty = feGroup
				}
			}
			Tx_Fileman_Domain_Model_Link {
				mapping.columns {
					tstamp.mapOnProperty = tstamp
					fe_group.mapOnProperty = feGroup
				}
			}
			Tx_Fileman_Domain_Model_FrontendUser {
				mapping.tableName = fe_users
			}
			Tx_Fileman_Domain_Model_FrontendUserGroup {
				mapping.tableName = fe_groups
			}
		}
	}
	jslib {
		jQuery.external = 1
		jQuery = {$plugin.tx_fileman.js.jQueryCDN}
		#TYPO3 4.6.0, http://forge.typo3.org/issues/29695 resolved? Clearly not, so for now:
		jQuery.disableCompression = 1
		
		inlineJS = TEMPLATE
		inlineJS.template = FILE
		inlineJS.template.file = {$plugin.tx_fileman.js.libFile}
		inlineJS.marks {
			XHR_PAGETYPE = TEXT
			XHR_PAGETYPE.value = {$plugin.tx_fileman.settings.type.xhr}
			XHR_PAGEID = TEXT
			XHR_PAGEID.value = {$plugin.tx_fileman.settings.pages.xhr}
			APC_FIELD_NAME = USER
			APC_FIELD_NAME.userFunc = Tx_Fileman_TypoScript->getApcFieldName
			SES_FIELD_NAME = USER
			SES_FIELD_NAME.userFunc = Tx_Fileman_TypoScript->getSesFieldName
			MAX_FILE_UPLOADS < lib.tx_fileman.maxFileUploads
			DEBUG = TEXT
			DEBUG.value = {$plugin.tx_fileman.js.debug}
			UPLOADPROGRESS = TEXT
			UPLOADPROGRESS.value = {$plugin.tx_fileman.js.uploadProgress}
			UPLOADTYPE = TEXT
			UPLOADTYPE.value = {$plugin.tx_fileman.js.uploadType}
			ALLOW_MIMETYPE = TEXT
			ALLOW_MIMETYPE.value = {$plugin.tx_fileman.js.allowMimeType}
			MAX_FILESIZE = TEXT
			MAX_FILESIZE.value = {$plugin.tx_fileman.js.maxFileSize}
			MAX_TOTAL_FILESIZE = TEXT
			MAX_TOTAL_FILESIZE.value = {$plugin.tx_fileman.js.maxTotalFileSize}
			CHUNKSIZE = TEXT
			CHUNKSIZE.value = {$plugin.tx_fileman.js.chunkSize}
			SENDING_FILE = TEXT
			SENDING_FILE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.sending_file
			ADD_FILE = TEXT
			ADD_FILE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.add_file
			DEL_FILE = TEXT
			DEL_FILE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.del_file
			DELETE_CONFIRM = TEXT
			DELETE_CONFIRM.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.delete_confirm
			SHOW_OPTIONAL = TEXT
			SHOW_OPTIONAL.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.show_optional
			VALID_FAIL_MIMETYPE = TEXT
			VALID_FAIL_MIMETYPE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.validate_failed_mimetype
			VALID_FAIL_MAXFILESIZE = TEXT
			VALID_FAIL_MAXFILESIZE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.validate_failed_maxfilesize
			VALID_FAIL_TOTFILESIZE = TEXT
			VALID_FAIL_TOTFILESIZE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.validate_failed_totalfilesize
			VALID_FAIL_FILECOUNT = TEXT
			VALID_FAIL_FILECOUNT.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.validate_failed_maxfilecount
			ERROR_FILE_TRANSFER = TEXT
			ERROR_FILE_TRANSFER.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.error_file_transfer
			ERROR_XHR_RESPONSE = TEXT
			ERROR_XHR_RESPONSE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.error_xhr_response
			DROP_ZONE = TEXT
			DROP_ZONE.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.drop_zone_text
			DROP_ZONE_TOOLTIP = TEXT
			DROP_ZONE_TOOLTIP.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.drop_zone_tooltip
			XHR_RETRY = TEXT
			XHR_RETRY.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.xhr_retry
			XHR_NO_PROGRESS = TEXT
			XHR_NO_PROGRESS.data = LLL:EXT:fileman/Resources/Private/Language/locallang.xml:tx_fileman_filelist.xhr_no_progress
		}
	}
	settings {
		type {
			xhr = {$plugin.tx_fileman.settings.type.xhr}
		}
		possibleOwnerGroup = {$plugin.tx_fileman.settings.possibleOwnerGroup}
		userLabelField = {$plugin.tx_fileman.settings.userLabelField}
		uploadDir = {$plugin.tx_fileman.settings.uploadDir}
		allowFileType = {$plugin.tx_fileman.settings.allowFileType}
		denyFileType = {$plugin.tx_fileman.settings.denyFileType}
		maxFileSize = {$plugin.tx_fileman.js.maxFileSize}
		maxTotalFileSize = {$plugin.tx_fileman.js.maxTotalFileSize}
	}
	features {
		# @TODO support before TYPO3 6.3 release
		rewrittenPropertyMapper = 0
	}
	objects {
		# extbase 6.1+ bugfix for rewrittenPropertyMapper=0
		TYPO3\CMS\Extbase\Persistence\Generic\PersistenceManager {
			className = Innologi\Fileman\Persistence\PersistenceManager
		}
		TYPO3\CMS\Extbase\Persistence\PersistenceManagerInterface {
			className = Innologi\Fileman\Persistence\PersistenceManagerInterface
		}
		# extbase 6.2+ bugfix for rewrittenPropertyMapper=0
		TYPO3\CMS\Extbase\Validation\ValidatorResolver {
			className = Tx_Fileman_Validation_ValidatorResolver
		}
	}
}

[globalVar = LIT:0 < {$plugin.tx_fileman.js.includeJquery}] && [globalVar = LIT:0 < {$plugin.tx_fileman.js.toFooter}] 
page.includeJSFooterlibs.fileman_jQuery < plugin.tx_fileman.jslib.jQuery

[globalVar = LIT:0 < {$plugin.tx_fileman.js.includeJquery}] && [globalVar = LIT:1 > {$plugin.tx_fileman.js.toFooter}] 
page.includeJSlibs.fileman_jQuery < plugin.tx_fileman.jslib.jQuery

[globalVar = LIT:0 < {$plugin.tx_fileman.js.includeJS}] && [globalVar = LIT:0 < {$plugin.tx_fileman.js.toFooter}]
page.jsFooterInline.198311310 < plugin.tx_fileman.jslib.inlineJS

[globalVar = LIT:0 < {$plugin.tx_fileman.js.includeJS}] && [globalVar = LIT:1 > {$plugin.tx_fileman.js.toFooter}]
page.jsInline.198311310 < plugin.tx_fileman.jslib.inlineJS
[global]

# XHR pagetype, not using eid because of required extbase controller context
# @TODO should probably consider eid though, not having to deal with pid bullshit etc.
fileman_xhr = PAGE
fileman_xhr {
	typeNum = {$plugin.tx_fileman.settings.type.xhr}
	config {
		disableAllHeaderCode = 1
		disablePrefixComment = 1
		xhtml_cleaning = 0
		admPanel = 0
		debug = 0
		no_cache = 1
		metaCharset = utf-8
	}
	10 = COA_INT
	10 < styles.content.get
	// exclusively take list content, regardless of colPos
	10.select.where = list_type = 'fileman_filelist'
}

plugin.tx_fileman._CSS_DEFAULT_STYLE (
	.tx-fileman .f3-form-error {
		background-color:#ff9f9f !important;
		border:1px #ff0000 solid !important;
	}
	
	.tx-fileman .legenda {
		margin:15px;
	}
	.tx-fileman .required {
		color:#f00;
	}
	
	.tx-fileman .fileupload.prepped {
		background-color: #E4FFCF;
		border: 1px solid #668822;
	}
	
	.tx-fileman .submit {
		border:1px solid #999;
		background-color:#ccc;
		display:block;
		margin-top:30px;
	}
	
	.tx-fileman .textinput,
	.tx-fileman textarea,
	.tx-fileman .fileupload {
		width:500px;
		border:1px solid #c2c2c1;
		background-color:#fafaf5;
	}
	
	.tx-fileman .small-textarea {
		height:100px;
	}
			
	
	
	.tx-fileman table {
		border: 2px solid #f2f2f1;
		border-collapse: separate;
		border-radius: 25px;
		border-spacing: 0 4px;
		padding: 5px 15px 13px;
		width: 100%;
	}
	
	.tx-fileman table caption {
		display:none;
	}
	
	.tx-fileman table,
	.tx-fileman form,
	.tx-fileman .error,
	.tx-fileman .buttons {
		clear:both;
	}

	.tx-fileman table th {
		font-weight:bold;
		text-align:left;
		font-size:1.2em;
	}

	.tx-fileman table td {
		vertical-align:top;
		background-color:#f7f7f1;
		padding:8px 15px;
	}
	
	.tx-fileman table .description {
		white-space: pre-wrap;
	}
	
	
	.tx-fileman .file-type-info {
		font-size:0.8em;
		opacity:0.9;
	}
	
	.tx-fileman a,
	.tx-fileman .one-button-form button {
		color:#66f;
		text-decoration:none;
		font-size:1.1em;
	}
	.tx-fileman a:hover,
	.tx-fileman a:focus,
	.tx-fileman a:active,
	.tx-fileman .one-button-form button:hover,
	.tx-fileman .one-button-form button:focus,
	.tx-fileman .one-button-form button:active {
		color:#f22;
	}
	
	.tx-fileman fieldset {
		border:0;
	}
	
	
	
	.tx-fileman .optional.indent {
		width:502px;
		padding-left:30px;
		border-left:1px solid #ddd;
		border-bottom:1px solid #ddd;
		margin-bottom:30px;
	}
	
	
	
	.tx-fileman .search-form {
		margin:5px 0;
		text-align:right;
		width:100%;
	}
	.tx-fileman .search-form .searchbox {
		width:130px;
	}
	.tx-fileman .search-form .searchsubmit {
		padding:0;
	}
	.tx-fileman .search-match {
		background-color:#ff0;
	}
	
	
	
	/* Buttons */
	
	.tx-fileman .buttons {
		margin:5px 0;
	}
	
	.tx-fileman .button-back,
	.tx-fileman .show-optional {
		margin-left:10px;
	}
	
	.tx-fileman .del-file-entry {
		margin-left:50px;
	}
	
	.tx-fileman .button-new {
		float:right;
		margin-right:10px;
	}
	
	.tx-fileman .button-new,
	.tx-fileman .button-back {
		margin-bottom:10px;
	}
	
	.tx-fileman .button-new,
	.tx-fileman .button-edit,
	.tx-fileman .button-delete,
	.tx-fileman .button-back,
	.tx-fileman .add-file-entry,
	.tx-fileman .del-file-entry,
	.tx-fileman .show-optional {
		display: inline-block;
	}
	
	.tx-fileman .button-new:before,
	.tx-fileman .button-edit:before,
	.tx-fileman .button-delete:before,
	.tx-fileman .button-back:before,
	.tx-fileman .add-file-entry:before,
	.tx-fileman .del-file-entry:before,
	.tx-fileman .show-optional:before,
	.tx-fileman .typo3-message .message-body:before,
	.tx-fileman .validation-errors .validation-header:before {
		background-image:url("/typo3conf/ext/fileman/Resources/Public/Icons/t3skin.png");
		content:"";
		float:left;
		height:16px;
		width:16px;
	}
	
	.tx-fileman .button-new:before,
	.tx-fileman .button-edit:before,
	.tx-fileman .button-delete:before,
	.tx-fileman .button-back:before,
	.tx-fileman .add-file-entry:before,
	.tx-fileman .del-file-entry:before,
	.tx-fileman .show-optional:before {
		margin:2px 8px 0 0;
	}
	
	.tx-fileman .typo3-message .message-body:before,
	.tx-fileman .validation-errors .validation-header:before {
		margin:0 8px 0 0;
	}
	
	
	
	.tx-fileman .button-edit,
	.tx-fileman .button-delete,
	.tx-fileman .del-file-entry,
	.tx-fileman .show-optional {
		overflow:hidden;
		width:18px;
		height:18px;	
	}
	
	.tx-fileman .add-file-entry.disabled,
	.tx-fileman .del-file-entry.disabled {
		opacity:0.2;
		cursor:default;
		color:#000;
	}
	
	.tx-fileman .del-file-entry.disabled {
		display:none;
	}
	
	.tx-fileman .button-new:before {
		background-position:-180px 0;	
	}
	.tx-fileman .button-edit:before {
		background-position:-198px 0;
	}
	.tx-fileman .button-delete:before {
		background-position:-162px -18px;
	}
	.tx-fileman .button-back:before {
		background-position:-18px -36px;
	}
	.tx-fileman .add-file-entry:before {
		background-position:-72px -18px;
	}
	.tx-fileman .del-file-entry:before {
		background-position:0 -234px;
	}
	.tx-fileman .show-optional:before {
		background-position:-198px 0;
	}
	.tx-fileman .show-optional.expanded:before {
		background-position:-216px 0;
	}
	
	.tx-fileman .one-button-form button {
		border:0;
		padding:0;
		background-color:transparent;
		cursor:pointer;
	}
	.tx-fileman .one-button-form,
	.tx-fileman .one-button-form fieldset {
		display:inline-block;
	}
	
	.tx-fileman .sorting {
		clear:both;
		float:right;
	}
	
	
	
	/* Messages */
	
	.tx-fileman .typo3-messages {
		overflow:hidden;
	}
	.tx-fileman .typo3-message,
	.tx-fileman .validation-errors {
		margin:8px 0;
		padding:10px;
		min-width:100px;
		font-size:0.9em;
	}
	.tx-fileman .typo3-message {
		float:left;
		clear:both;
	}
	.tx-fileman .validation-errors {
		display:inline-block;
	}
	.tx-fileman ul.validation-error-messages {
		list-style-type:square;
	}
		
	.tx-fileman .typo3-message .message-header,
	.tx-fileman .validation-errors .validation-fieldname {
		font-weight:bold;
	}
	
	.tx-fileman .typo3-message.message-error,
	.tx-fileman .validation-errors {
		background-color:#fcb;
		border:1px solid #ea9;
		color:#a33;
	}
	
	.tx-fileman .typo3-message.message-warning {
		background-color:#ffb;
		border:1px solid #f5d588;
		color:#85510d;
	}
	
	.tx-fileman .typo3-message.message-notice {
		background-color:#e4e4e4;
		border:1px solid #d5d5d5;
		color:#443;
	}
	
	.tx-fileman .typo3-message.message-information {
		background-color:#def;
		border:1px solid #cdf;
		color:#469;
	}
	
	.tx-fileman .typo3-message.message-ok {
		background-color:#cdefc0;
		border:1px solid #b9ddaa;
		color:#3b7826;
		
	}
	
	.tx-fileman .typo3-message.message-error .message-body:before,
	.tx-fileman .validation-errors .validation-header:before {
		background-position:-306px -198px;
	}
	.tx-fileman .typo3-message.message-warning .message-body:before {
		background-position:-54px -216px;
	}
	.tx-fileman .typo3-message.message-notice .message-body:before {
		background-position:-18px -216px;
	}
	.tx-fileman .typo3-message.message-information .message-body:before {
		background-position:0 -216px;
	}
	.tx-fileman .typo3-message.message-ok .message-body:before {
		background-position:-36px -216px;
	}
	
	
	
	/* upload progress bar */
	
	.tx-fileman .uploadprogress {
		display:none;
		border:1px solid #888;
		padding:1%;
		height:30px;
		width:98%;
		background-color:#fff;
		overflow:visible;
		margin-bottom:15px;
	}
	
	.tx-fileman .uploadprogress .progressbar {
		width:0;
		height:100%;
		background-color:#bbf;
	}
	
	.tx-fileman .uploadprogress .progressvalue {
		text-align:center;
		height:10px;
		margin-top:5px;
	}
	
	
	
	/* related link switch */
	
	.tx-fileman .rel-switch {
		margin-left:8px;
		font-size:0.9em;
		display:none;
	}
	.tx-fileman .rel-switch:before {
		content:"[\25BC]";
		font-size:0.8em;
	}
	
	.tx-fileman .rel-links {
		margin-top:10px;
		font-size:0.9em;
	}
	
	.tx-fileman .rel-links ol {
		margin-top:0;
	}
	
	.tx-fileman .rel-links a {
		border-bottom:1px dotted;
		font-style:italic;
	}
	
	
	.tx-fileman .drop-zone {
		position:relative;
	}
	.tx-fileman .drop-zone .drop-overlay {
		position:absolute;
		background-image:url("/typo3conf/ext/fileman/Resources/Public/Images/arrowdown.png");
		background-repeat:no-repeat;
		background-position:50% 50%;
		height:100%;
		width:99%;
		display:none;
		z-index:100;
	}
	.tx-fileman .drop-zone .drop-overlay.loading {
		background-image:url("/typo3conf/ext/fileman/Resources/Public/Images/loading.gif");
	}
	.tx-fileman .drop-zone .drop-here {
		height:65px;
		width:150px;
		margin-bottom:10px;
		text-align:center;
		font-size:1.5em;
		padding-top:12px;
		color:#99d
	}
	.tx-fileman .drop-zone .drop-overlay,
	.tx-fileman .drop-zone .drop-here {
		border:5px dashed #aaf;
		background-color:#eef;
	}
)