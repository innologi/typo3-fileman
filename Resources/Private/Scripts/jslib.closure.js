jQuery(document).ready(function(){function ea(a){a=a.replace(/\\/g,"/");return a.substring(a.lastIndexOf("/")+1)}function N(a){var b=jQuery(a).find(".optional .textinput:first");jQuery(a).data("titleUnchanged",true);b.keyup(function(){jQuery(a).data("titleUnchanged",false)});jQuery(a).find(".fileupload").change(function(){jQuery(a).data("titleUnchanged")&&b.val(ea(jQuery(this).val()))})}function O(a,b,c){if(b.hasClass("file-checker-error")){b.removeClass("f3-form-error file-checker-error");b.parent("label").prev(".typo3-messages").remove()}var d=
c+0,h=false;if(a.length>0)for(var e=0;e<a.length;e++){var f=a[e];d=c+e;if(P.length>0){var i=fa(f.type,'"');v(b,!(new RegExp("^("+P+")","i")).test(i),"File type denied for '"+f.name+"': "+f.type,"###VALID_FAIL_MIMETYPE###".replace("{fileName}",f.name))||(h=true)}if(w>0)v(b,f.size>w,"File size "+f.size+" of '"+f.name+"' exceeds set limit: "+w,"###VALID_FAIL_MAXFILESIZE###".replace("{maxFileSize}",x(w)).replace("{fileName}",f.name))||(h=true);l[d]=f.size}else l.hasOwnProperty(d)&&delete l[d];o=0;for(e in l)if(l.hasOwnProperty(e))o+=
l[e];Q=x(o);if(y>0)v(b,o>y,"Total file size "+o+" exceeds set limit: "+y,"###VALID_FAIL_TOTFILESIZE###".replace("{maxTotalFileSize}",x(y)))||(h=true);return!h}function v(a,b,c,d){if(b){console.log(c);a.val(null);a.addClass("f3-form-error file-checker-error");F(d,a.parent("label"));return false}return true}function F(a,b){a='<div class="typo3-message message-error">'+a+"</div>";var c=b.prev(".typo3-messages");c[0]?c.append(a):b.before('<div class="typo3-messages">'+a+"</div>")}function fa(a,b){for(;a.charAt(0)===
b;)a=a.substring(1);for(;a.charAt(a.length-1)===b;)a=a.substring(0,a.length-1);return a}function x(a){if(a==0)return"n/a";var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(a/Math.pow(1024,b)).toFixed(1)+" "+["Bytes","KB","MB","GB","TB"][b]}function R(a,b){jQuery.get("/typo3conf/ext/fileman/Resources/Public/Scripts/UploadProgress.php",{upload_id:a,no_cache:Math.random(),type:r},function(c){var d=parseInt(c);if(s=="1"&&isNaN(d))jQuery(".tx-fileman #fileman-uploadProgress"+b+" .progressvalue").html("Not receiving upload-progress status: "+
c);else{jQuery(".tx-fileman #fileman-uploadProgress"+b+" .progressbar").css({width:d+"%"});if(d==100){clearInterval(S[b]);jQuery(".tx-fileman #fileman-uploadProgress"+b+" .progressvalue").text(z+" 99%")}else jQuery(".tx-fileman #fileman-uploadProgress"+b+" .progressvalue").text(z+" "+d+"%")}})}function ga(){if(G==="js"){jQuery(".tx-fileman .init-progressbar").each(function(a,b){a++;jQuery(b).on("submit",function(c){if(!H){c.preventDefault();ha(this,a)}})});T=true}}function ha(a,b){var c=0;jQuery(".fileupload",
a).each(function(h,e){var f=jQuery(e);h++;if(e.files!==undefined&&e.files!==null&&e.files.length>0&&e.files[0]instanceof File&&e.files[0].name.length>0)t.push({file:e.files[0],formIndex:b,uploadIndex:h,form:a});else{e=f.val();e!==undefined&&e.length>0&&c++}if(t.length>0){f.after('<input type="text" name="tx_fileman_filelist[files][file][i'+h+'][fileUri]" readonly="readonly" class="fileupload fill-'+h+'" value="" /><input type="hidden" name="tx_fileman_filelist[tmpFiles][i'+h+']" class="tmpfile fill-'+
h+'" value="" />');f.remove()}});if(t.length>0){jQuery(a).hide();A=jQuery(".tx-fileman #fileman-uploadProgress"+b);A.show();var d=t.shift();I(d.file,d.formIndex,d.uploadIndex,d.form)}else if(c>0){H=true;jQuery(a).submit()}}function I(a,b,c,d){var h=new FileReader,e=new XMLHttpRequest,f=0,i=B,p=o*1.33,q=0,J=a.name;h.onload=function(g){e.open("PUT","/typo3conf/ext/fileman/Resources/Public/Scripts/FileTransfer.php?filename="+J+"&state="+q+"&no_cache="+Math.random());e.setRequestHeader("Content-Type",
"application/octet-stream");e.responseType="json";e.send(g.target.result)};h.onerror=function(){console.log("ERROR: Could not read file")};e.addEventListener("load",function(g){q=1;if(g.target.response){g=g.target.response;if(typeof g!=="object")g=JSON.parse(g);s=="1"&&console.log(g);if(g.success&&g.success===1){if(g.tmp_name)J=g.tmp_name;if(i<a.size){f=i;i+=B;if(i>a.size)i=a.size;h.readAsDataURL(a.slice(f,i))}else{jQuery(".tmpfile.fill-"+c,d).val(J);jQuery(".fileupload.fill-"+c,d).val(a.name);g=
t.shift();if(g===undefined){H=true;jQuery(d).submit()}else I(g.file,g.formIndex,g.uploadIndex,g.form)}}else{console.log("ERROR: File transfer failure");F("###ERROR_FILE_TRANSFER###",A)}}else{console.log("ERROR: No valid XHR response");F("###ERROR_XHR_RESPONSE###",A);s=="1"&&console.log(g)}},false);e.addEventListener("error",function(){console.log("ERROR: No connection, retrying in 30 seconds");jQuery(".tx-fileman #fileman-uploadProgress"+b+" .progressvalue").text("###XHR_RETRY###");setTimeout(function(){I(a,
b,c,d)},3E4)},false);e.upload.addEventListener("progress",function(g){var C=jQuery(".tx-fileman #fileman-uploadProgress"+b+" .progressvalue"),U=jQuery(".tx-fileman #fileman-uploadProgress"+b+" .progressbar");if(C[0]&&U[0])if(g.lengthComputable){var W=V+g.loaded,m=W/p*100;if(m>100)m=100;s=="1"&&console.log(m);U.css({width:m+"%"});m=parseInt(m);m===100?C.text(z+" 99%"):C.text(z+" "+m+"% ("+x(W/1.33)+" / "+Q+")");if(g.loaded===g.total)V+=g.total}else s=="1"&&C.html("###XHR_NO_PROGRESS###")},false);if(i>
a.size)i=a.size;h.readAsDataURL(a.slice(f,i))}function X(a,b,c,d){if(a.fileCount>1&&!jQuery(c).hasClass("disabled")){a.fileCount==k&&b.removeClass("disabled");a.fileCount--;b=jQuery(c).parents(".file-entry");c=b.find("input[type=file].fileupload");c.val(null);c.change();b.remove();a.lastIndex=Y(d);a.fileCount==1&&jQuery(d).find("a.del-file-entry").addClass("disabled")}}function Y(a){return jQuery(a).find(".fileupload:last").attr("name").match(/\[file\]\[i([0-9]+)\]/i)[1]}function Z(a,b){jQuery(a).slideToggle();
jQuery(b).toggleClass("expanded")}function $(a){if(D){a.hide();D=false}}function ia(a,b){var c=a.dataTransfer,d=[];if(c.items)for(a=0;a<c.items.length;a++)c.items[a].kind=="file"&&d.push(c.items[a].getAsFile());else d=c.files;if(d.length>0){a=jQuery(".file-entry",b);c=a.first().find(".fileupload");var h=null;if(c.hasClass("file-checker-error")){c.removeClass("f3-form-error file-checker-error");c.parent("label").prev(".typo3-messages").remove()}if(!v(c,d.length>k,"Max file count is "+k+", tried uploading "+
d.length,"###VALID_FAIL_FILECOUNT###".replace("{maxFileCount}",k)))return false;l={};if(!O(d,c,"dragNdrop")){l={};return false}if(d.length!==a.length)if(d.length>a.length){c=d.length-a.length;var e=jQuery("a.add-file-entry",b);for(a=0;a<c;a++)e.click()}else a.slice((a.length-d.length)*-1).remove();jQuery(".file-entry",b).each(function(f,i){h=jQuery('<span class="fileupload">'+d[f].name+"</span>");h[0].files=[d[f]];jQuery(".fileupload",i).replaceWith(h)});jQuery(b).submit()}}function aa(a,b){var c=
new XMLHttpRequest;c.open("HEAD","index.php?id="+ba+"&type="+ca+"&tx_fileman_filelist[controller]=Category&tx_fileman_filelist[action]=ajaxVerifyToken&tx_fileman_filelist[encodedUrl]="+b,false);c.setRequestHeader("innologi--stoken",a);c.send()}var j=jQuery(".tx-fileman .search-form .searchbox");if(j[0]){var ja=j.width(),n=j[0].value.trim();j.val().length>0&&j.css({width:"85%"});j.on("focus",function(){this.value.length<1&&jQuery(this).animate({width:"85%"})});j.on("blur",function(){this.value.length<
1&&jQuery(this).animate({width:ja})});if(n.length>0){n=n.split(" ");for(var K in n)n.hasOwnProperty(K)&&n[K].length<1&&n.splice(K,1);var ka=new RegExp("("+n.join("|")+")(?![^<]*>|[^<>]</)","ig");jQuery(".tx-fileman table.tx_fileman").each(function(a,b){a=jQuery(b);a.html(a.html().replace(ka,'<span class="search-match">$1</span>'))})}}jQuery(".tx-fileman .rel-switch").click(function(){jQuery(this).next(".tx-fileman .rel-links").slideToggle();return false});jQuery(".tx-fileman .rel-switch").show();
jQuery(".tx-fileman .rel-links").hide();jQuery(".tx-fileman .file-entry").each(function(a,b){N(b)});var L=""+(new Date).getTime()+Math.random();L=L.replace(".","");var S={},z="###SENDING_FILE###",s="###DEBUG###",r="###UPLOADPROGRESS###",G="###UPLOADTYPE###",t=[],T=false,H=false,P="###ALLOW_MIMETYPE###",w=parseInt("###MAX_FILESIZE###"),y=parseInt("###MAX_TOTAL_FILESIZE###"),l={},o=0,Q="",V=0,B=parseInt("###CHUNKSIZE###"),A=null;if(B<1)B=1048576;if(window.File){jQuery(".tx-fileman form").on("change",
"input[type=file].fileupload",function(){var a=jQuery(this);if(!O(this.files,a,a.attr("name")))return false});window.FileReader&&ga()}if(G==="js"||r!="none")jQuery(".tx-fileman .init-progressbar").each(function(a,b){a++;jQuery(b).after('<div id="fileman-uploadProgress'+a+'" class="uploadprogress"><div class="progressbar"></div><div class="progressvalue"></div></div>');if(G!=="js"){var c=a+L;if(r=="session")jQuery(b).prepend('<input type="hidden" name="###SES_FIELD_NAME###" value="'+c+'" />');else if(r==
"apc")jQuery(b).prepend('<input type="hidden" name="###APC_FIELD_NAME###" value="'+c+'" />');else r=="uploadprogress"&&jQuery(b).prepend('<input type="hidden" name="UPLOAD_IDENTIFIER" value="'+c+'" />');jQuery(b).on("submit",function(){var d=jQuery(this).find("input[type=file].fileupload").val();if(d!==undefined&&d!==""){jQuery(this).hide();jQuery(".tx-fileman #fileman-uploadProgress"+a).show();S[a]=setInterval(function(){R(c,a)},100);R(c,a)}})}});var k=parseInt("###MAX_FILE_UPLOADS###");k>1&&jQuery(".tx-fileman .multi-file").each(function(a,
b){a=jQuery(b).find(".file-entry");var c={fileCount:a.size(),lastIndex:Y(b)};jQuery(b).find(".submit").before('<a href="#" class="add-file-entry" title="###ADD_FILE###">###ADD_FILE###</a><a href="#" class="del-file-entry" title="###DEL_FILE###">###DEL_FILE###</a>');var d=jQuery(b).find("a.add-file-entry"),h=d.next("a.del-file-entry");h.remove();c.fileCount==k&&d.addClass("disabled");c.fileCount==1&&h.addClass("disabled");jQuery(b).hasClass("multi-file-add")||d.hide();a.each(function(e,f){e=jQuery(f).find(".fileupload");
var i=h.clone();jQuery(i).insertAfter(e);jQuery(i).click(function(){X(c,d,this,b);return false});var p=jQuery(f).find(".optional");p.hide();p.addClass("indent");e.after('<a href="#" class="show-optional" title="###SHOW_OPTIONAL###">###SHOW_OPTIONAL###</a>');jQuery(f).find(".show-optional").click(function(){Z(p,this);return false})});if(jQuery(b).hasClass("multi-file-add"))jQuery(b).find("a.add-file-entry").click(function(){if(c.fileCount<k&&!jQuery(this).hasClass("disabled")){c.fileCount==1&&jQuery(b).find("a.del-file-entry").removeClass("disabled");
c.fileCount++;var e=jQuery(this).prevAll(".file-entry:first").clone(),f="[file][i"+c.lastIndex+"]",i="[file][i"+ ++c.lastIndex+"]";jQuery(e).find("input[type=file],input[type=text],textarea").each(function(p,q){jQuery(q).attr("name",jQuery(q).attr("name").replace(f,i));jQuery(q).val(null)});jQuery(e).find(".show-optional").click(function(){Z(jQuery(e).find(".optional"),this);return false});N(e);jQuery(e).find("a.del-file-entry").click(function(){X(c,d,this,b);return false});jQuery(this).before(e);
c.fileCount==k&&d.addClass("disabled")}return false});else k=1});var D=false;if(T&&"draggable"in document.createElement("span")){$dropzones=jQuery(".tx-fileman .drop-zone");if($dropzones.length>0){$dropzones.prepend('<div class="drop-overlay"></div><div class="drop-here" title="###DROP_ZONE_TOOLTIP###">###DROP_ZONE###</div>');$dropzones.on("drop",function(a){a.originalEvent.preventDefault();var b=jQuery(".drop-overlay",this);b.toggleClass("loading");if(!ia(a.originalEvent,this)){$(b);b.toggleClass("loading")}});
$dropzones.on("dragover",function(a){a.originalEvent.preventDefault()});$dropzones.on("dragenter",function(a){a.originalEvent.preventDefault();a.originalEvent.stopPropagation();if(!D){jQuery(".drop-overlay",this).show();D=true}});jQuery(".drop-overlay",$dropzones).on("dragleave",function(a){a.originalEvent.preventDefault();a.originalEvent.stopPropagation();$(jQuery(this));console.log("LEAVE")})}}var u=jQuery(".tx-fileman a.csrf-protect"),E=jQuery(".tx-fileman form.csrf-protect"),ca="###XHR_PAGETYPE###",
ba="###XHR_PAGEID###";if(u[0]||E[0]){var da=jQuery(":submit",E),M=[];da.hide();u.hide();u.each(function(a,b){M.push(jQuery(b).attr("data-utoken"))});E.each(function(a,b){M.push(jQuery(b).attr("data-utoken"))});j=new XMLHttpRequest;j.open("HEAD","index.php?id="+ba+"&type="+ca+"&tx_fileman_filelist[controller]=Category&tx_fileman_filelist[action]=ajaxGenerateTokens",true);j.setRequestHeader("innologi--utoken",M);j.onload=function(){if(this.status==200){var a=this.getResponseHeader("innologi__stoken"),
b=0;if(a!==null){a=a.split(",");u.each(function(c,d){jQuery(d).attr("data-stoken",a[b++]);jQuery(d).click(function(){aa(jQuery(this).attr("data-stoken"),jQuery(this).attr("data-utoken"))})});E.each(function(c,d){jQuery(d).attr("data-stoken",a[b++]);jQuery(d).submit(function(){aa(jQuery(this).attr("data-stoken"),jQuery(this).attr("data-utoken"))})})}}da.show();u.show()};j.send()}});